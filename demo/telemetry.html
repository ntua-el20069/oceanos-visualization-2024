<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telemetry visualization</title>
    <script src="scripts/jquery-1.11.3.min.js"></script>
    <link type="text/css" href="../dist/roundslider.min.css" rel="stylesheet" />
    <script src="../dist/roundslider.min.js"></script>
</head>
<body> 
    <div>
        <h2 id="mode">Normal Mode</h2>
        <button id="switchMode" onclick="changeSimulate()"> Switch to Simulation Mode </button>
    </div>
    <div class="grid-container">

    </div>
</body>

<script type="text/javascript">

function generateRandomFloat(min, max, step) {
    var randomNumber = Math.random() * (max - min) + min;
    if (step >= 0.1) return Math.round(randomNumber * 10) / 10;
    else if (step >= 0.01) return Math.round(randomNumber * 100) / 100;
    else return randomNumber;
}

    

    class Data {
        constructor(id, definition,  max = 100, min = 0, step = 0.1, value = (min + max) / 2) {
            this.id = id;
            this.definition = definition;
            this.max = max;
            this.min = min;
            this.step = step;
            this.value = value;
        }
        change(value){
            this.value = value;
        }
    }

datalist = [ 
    new Data("charge", "State of Charge (%)", 100) , 
    new Data("tempBattery", "Battery Temperature (°C)", 50) , 
    new Data("speed", "Speed (kn)", 20) , 
    new Data("tempMosfet", "Mosfet Temperature (°C)", 90) , 
    new Data("motorCurrent", "Motor Current (A)", 250) , 
    new Data("tempMotor", "Motor Temperature (°C)", 75) 
]

numericData = [
   new Data('autonomy', 'Autonomy'),
   new Data('miles', 'Miles (miles)'),
   new Data('milesPerLap', 'Miles per Lap (miles)'),
   new Data('rpm', 'RPM (rpm)')
]

const parent = document.querySelector('.grid-container');

for (data of numericData){
    
    const dataDiv = document.createElement('div');
    dataDiv.classList.add('visualization');
    const h3Element = document.createElement('h3');
    h3Element.textContent = data.definition;
    const pElement = document.createElement('p');
    pElement.id = data.id;
    pElement.textContent = data.value;
    // Append elements to construct the structure
    
    dataDiv.appendChild(h3Element);
    dataDiv.appendChild(pElement);

    // Add the constructed element to the document body or another parent element
    parent.appendChild(dataDiv);
}

// Construction of divs for visualization
for (data of datalist){
    

    // Create main elements
    const dataDiv = document.createElement('div');
    dataDiv.classList.add('visualization');

    const h3Element = document.createElement('h3');
    h3Element.textContent = data.definition;

    const containerDiv = document.createElement('div');
    containerDiv.classList.add('container');

    const controlDiv = document.createElement('div');
    controlDiv.classList.add('control');

    const shapeDiv = document.createElement('div');
    shapeDiv.id = data.id;

    // Append elements to construct the structure
    controlDiv.appendChild(shapeDiv);
    containerDiv.appendChild(controlDiv);

    dataDiv.appendChild(h3Element);
    dataDiv.appendChild(containerDiv);

    // Add the constructed element to the document body or another parent element
    parent.appendChild(dataDiv);
}

function display(){
    $(document).ready(function () {             // Here I use the function from the roundSlider library
        for (data of datalist)  
            $(`#${data.id}`).roundSlider({
                svgMode: true,
                value: data.value,                          // this is what changes ... (e.g. the value of tempMosfet)
                sliderType: "min-range",
                circleShape: "half-top",
                min: data.min,
                max: data.max,
                step: data.step,
                readOnly: true
            });
        for (data of numericData) document.querySelector(`#${data.id}`).textContent = data.value;
    });
}

display();

let simulate = false;
let modeText = '';
let switchText = '';
function changeSimulate(){ 
    simulate = !simulate; 
    console.log(simulate);
    if (simulate) { modeText = "Simulation Mode"; switchText = 'Switch to Normal Mode'; }
    else { modeText = "Normal Mode"; switchText = 'Switch to Simulation Mode'; }
    document.querySelector('#mode').textContent = modeText;
    document.querySelector('#switchMode').textContent = switchText;
}

setInterval(function() {
    for (data of datalist.concat(numericData)) {
        if (simulate) {
            const randomFloat = generateRandomFloat(data.min, data.max, data.step);
            data.change(randomFloat);
            console.log(randomFloat);
        }
        display();
    }
         // Change this to display the float where you want
         // You can perform other operations with the random float here
}, 1000); // Interval set to 1000ms (1 second)
    

</script>

<style>
        h1 span {
            font-size: 0.6em;
        }
        .grid-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between; /* Adjust as needed */
        }
        .visualization {
          display: inline-block;
          padding: 10px 20px;
          border: 1px dotted;
          margin-right: 2%;
          overflow: hidden;

        flex: 0 0 18%;
        /*  width: calc(33.3% - 10px);  /* Adjust width or use percentages */
        margin-bottom: 1%; /* Optional margin */
        background-color: #f0f0f0; /* Just for visualization */
        text-align: center; /* Optional */

        }
        .container {
            max-width: 100%; /* Container takes full width of the viewport */
            padding: 0 20px; /* Add padding to the sides */
            box-sizing: border-box; /* Include padding and border in the width */
            height: 180px;
            width: 400px;
            display: flex;
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            margin: 0 auto; /* To center the container itself on the page */ 
        }
        /*.container > div {
          float: middle;
        }*/
        .control {
            margin-right: 20px;
        }

        @media screen and (max-width: 768px) {
            .visualization {
                flex: 0 0 100%; /* Full width for smaller screens */
                margin-right: 0; /* No right margin */
            }
            
            .container {
                width: 100%; /* Container takes full width of the viewport */
            }
            
            .control {
                margin-right: 10px; /* Adjust margin */
            }
        }

</style>

</html>